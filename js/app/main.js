//
//  ____  _                           _
// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)
// \___ \| __/ _` | '_ \ / _ \/ __|  | / __|
//  ___) | || (_| | |_) |  __/\__ \_ | \__ \
// |____/ \__\__,_| .__/ \___||___(_)/ |___/
//              |_|              |__/
//
// (*) a (really) tiny Javascript MVC microframework
//
// (c) Hay Kranen < hay@bykr.org >
// Released under the terms of the MIT license
// < http://en.wikipedia.org/wiki/MIT_License >
//
// Stapes.js : http://hay.github.com/stapes

(function(){"use strict";var e="0.8.0",t=1;if(!Object.create)var n=function(){};var r=Array.prototype.slice,i={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(e){i.eventHandlers[e.guid][e.type]||(i.eventHandlers[e.guid][e.type]=[]),i.eventHandlers[e.guid][e.type].push({guid:e.guid,handler:e.handler,scope:e.scope,type:e.type})},addEventHandler:function(e,t,n){var r={},s;typeof e=="string"?(s=n||!1,r[e]=t):(s=t||!1,r=e);for(var o in r){var u=r[o],a=o.split(" ");for(var f=0,l=a.length;f<l;f++){var c=a[f];i.addEvent.call(this,{guid:this._guid||this._.guid,handler:u,scope:s,type:c})}}},addGuid:function(e,n){if(e._guid&&!n)return;e._guid=t++,i.attributes[e._guid]={},i.eventHandlers[e._guid]={}},attr:function(e){return i.attributes[e]},clone:function(e){var t=i.typeOf(e);if(t==="object")return i.extend({},e);if(t==="array")return e.slice(0)},create:function(e){return Object.create?Object.create(e):(n.prototype=e,new n)},createSubclass:function(e,t){function o(){if(!(this instanceof o))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&i.addGuid(this,!0),r.apply(this,arguments)}e=e||{},t=t||!1;var n=e.superclass.prototype,r=e.hasOwnProperty("constructor")?e.constructor:function(){};t&&i.extend(n,s),o.prototype=i.create(n),o.prototype.constructor=o,i.extend(o,{extend:function(){return i.extendThis.apply(this,arguments)},parent:n,proto:function(){return i.extendThis.apply(this.prototype,arguments)},subclass:function(e){return e=e||{},e.superclass=this,i.createSubclass(e)}});for(var u in e)u!=="constructor"&&u!=="superclass"&&(o.prototype[u]=e[u]);return o},emitEvents:function(e,t,n,s){n=n||!1,s=s||this._guid;var o=r.call(i.eventHandlers[s][e]);for(var u=0,a=o.length;u<a;u++){var f=i.extend({},o[u]),l=f.scope?f.scope:this;n&&(f.type=n),f.scope=l,f.handler.call(f.scope,t,f)}},extend:function(){var e=r.call(arguments),t=e.shift();for(var n=0,i=e.length;n<i;n++){var s=e[n];for(var o in s)t[o]=s[o]}return t},extendThis:function(){var e=r.call(arguments);return e.unshift(this),i.extend.apply(this,e)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},removeAttribute:function(e,t){t=t||!1;var n=i.trim(e).split(" ");for(var r=0,s=n.length;r<s;r++){var o=i.trim(n[r]);o&&(delete i.attr(this._guid)[o],t||(this.emit("change",o),this.emit("change:"+o),this.emit("remove",o),this.emit("remove:"+o)))}},removeEventHandler:function(e,t){var n=i.eventHandlers[this._guid];if(e&&t){n=n[e];if(!n)return;for(var r=0,s=n.length,o;r<s;r++)o=n[r].handler,o&&o===t&&(n.splice(r--,1),s--)}else e?delete n[e]:i.eventHandlers[this._guid]={}},setAttribute:function(e,t,n){n=n||!1;var r=this.has(e),s=i.attr(this._guid)[e];if(t===s)return;i.attr(this._guid)[e]=t;if(n)return;this.emit("change",e),this.emit("change:"+e,t);var o={key:e,newValue:t,oldValue:s||null};this.emit("mutate",o),this.emit("mutate:"+e,o);var u=r?"update":"create";this.emit(u,e),this.emit(u+":"+e,t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(e){return e===null||typeof e=="undefined"?String(e):Object.prototype.toString.call(e).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(e,t,n){var r=this.get(e),s=i.typeOf(r);if(s==="object"||s==="array")r=i.clone(r);var o=t.call(this,r,e);i.setAttribute.call(this,e,o,n||!1)}},s={emit:function(e,t){t=typeof t=="undefined"?null:t;var n=e.split(" ");for(var r=0,s=n.length;r<s;r++){var o=n[r];i.eventHandlers[-1].all&&i.emitEvents.call(this,"all",t,o,-1),i.eventHandlers[-1][o]&&i.emitEvents.call(this,o,t,o,-1),typeof this._guid=="number"&&(i.eventHandlers[this._guid].all&&i.emitEvents.call(this,"all",t,o),i.eventHandlers[this._guid][o]&&i.emitEvents.call(this,o,t))}},off:function(){i.removeEventHandler.apply(this,arguments)},on:function(){i.addEventHandler.apply(this,arguments)}};i.Module=function(){},i.Module.prototype={each:function(e,t){var n=i.attr(this._guid);for(var r in n){var s=n[r];e.call(t||this,s,r)}},extend:function(){return i.extendThis.apply(this,arguments)},filter:function(e){var t=[],n=i.attr(this._guid);for(var r in n)e.call(this,n[r],r)&&t.push(n[r]);return t},get:function(e){if(typeof e=="string")return this.has(e)?i.attr(this._guid)[e]:null;if(typeof e=="function"){var t=this.filter(e);return t.length?t[0]:null}},getAll:function(){return i.clone(i.attr(this._guid))},getAllAsArray:function(){var e=[],t=i.attr(this._guid);for(var n in t){var r=t[n];i.typeOf(r)==="object"&&!r.id&&(r.id=n),e.push(r)}return e},has:function(e){return typeof i.attr(this._guid)[e]!="undefined"},map:function(e,t){var n=[];return this.each(function(r,i){n.push(e.call(t||this,r,i))},t||this),n},push:function(e,t){if(i.typeOf(e)==="array")for(var n=0,r=e.length;n<r;n++)i.setAttribute.call(this,i.makeUuid(),e[n],t||!1);else i.setAttribute.call(this,i.makeUuid(),e,t||!1);return this},remove:function(e,t){return typeof e=="undefined"?(i.attributes[this._guid]={},this.emit("change remove")):typeof e=="function"?this.each(function(n,r){e(n)&&i.removeAttribute.call(this,r,t)}):i.removeAttribute.call(this,e,t||!1),this},set:function(e,t,n){if(typeof e=="object")for(var r in e)i.setAttribute.call(this,r,e[r],t||!1);else i.setAttribute.call(this,e,t,n||!1);return this},size:function(){var e=0,t=i.attr(this._guid);for(var n in t)e++;return e},update:function(e,t,n){return typeof e=="string"?i.updateAttribute.call(this,e,t,n||!1):typeof e=="function"&&this.each(function(t,n){i.updateAttribute.call(this,n,e)}),this}};var o={_:i,extend:function(){return i.extendThis.apply(i.Module.prototype,arguments)},mixinEvents:function(e){return e=e||{},i.addGuid(e),i.extend(e,s)},on:function(){i.addEventHandler.apply(this,arguments)},subclass:function(e,t){return t=t||!1,e=e||{},e.superclass=t?function(){}:i.Module,i.createSubclass(e,!t)},version:e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=o),exports.Stapes=o):typeof define=="function"&&define.amd?define("lib/stapes",[],function(){return o}):window.Stapes=o})(),function(){function f(e){var t={r:0,g:0,b:0},n=1,r=!1,i=!1;return typeof e=="string"&&(e=W(e)),typeof e=="object"&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=l(e.r,e.g,e.b),r=!0,i=String(e.r).substr(-1)==="%"?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=q(e.s),e.v=q(e.v),t=d(e.h,e.s,e.v),r=!0,i="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=q(e.s),e.l=q(e.l),t=h(e.h,e.s,e.l),r=!0,i="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=D(n),{ok:r,format:e.format||i,r:s(255,o(t.r,0)),g:s(255,o(t.g,0)),b:s(255,o(t.b,0)),a:n}}function l(e,t,n){return{r:P(e,255)*255,g:P(t,255)*255,b:P(n,255)*255}}function c(e,t,n){e=P(e,255),t=P(t,255),n=P(n,255);var r=o(e,t,n),i=s(e,t,n),u,a,f=(r+i)/2;if(r==i)u=a=0;else{var l=r-i;a=f>.5?l/(2-r-i):l/(r+i);switch(r){case e:u=(t-n)/l+(t<n?6:0);break;case t:u=(n-e)/l+2;break;case n:u=(e-t)/l+4}u/=6}return{h:u,s:a,l:f}}function h(e,t,n){function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var r,i,s;e=P(e,360),t=P(t,100),n=P(n,100);if(t===0)r=i=s=n;else{var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return{r:r*255,g:i*255,b:s*255}}function p(e,t,n){e=P(e,255),t=P(t,255),n=P(n,255);var r=o(e,t,n),i=s(e,t,n),u,a,f=r,l=r-i;a=r===0?0:l/r;if(r==i)u=0;else{switch(r){case e:u=(t-n)/l+(t<n?6:0);break;case t:u=(n-e)/l+2;break;case n:u=(e-t)/l+4}u/=6}return{h:u,s:a,v:f}}function d(e,t,n){e=P(e,360)*6,t=P(t,100),n=P(n,100);var i=r.floor(e),s=e-i,o=n*(1-t),u=n*(1-s*t),a=n*(1-(1-s)*t),f=i%6,l=[n,u,o,o,a,n][f],c=[a,n,n,u,o,o][f],h=[o,o,a,n,n,u][f];return{r:l*255,g:c*255,b:h*255}}function v(e,t,n,r){var s=[I(i(e).toString(16)),I(i(t).toString(16)),I(i(n).toString(16))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function m(e,t,n,r){var s=[I(R(r)),I(i(e).toString(16)),I(i(t).toString(16)),I(i(n).toString(16))];return s.join("")}function g(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.s-=t/100,n.s=H(n.s),a(n)}function y(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.s+=t/100,n.s=H(n.s),a(n)}function b(e){return a(e).desaturate(100)}function w(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.l+=t/100,n.l=H(n.l),a(n)}function E(e,t){t=t===0?0:t||10;var n=a(e).toRgb();return n.r=o(0,s(255,n.r-i(255*-(t/100)))),n.g=o(0,s(255,n.g-i(255*-(t/100)))),n.b=o(0,s(255,n.b-i(255*-(t/100)))),a(n)}function S(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.l-=t/100,n.l=H(n.l),a(n)}function x(e,t){var n=a(e).toHsl(),r=(i(n.h)+t)%360;return n.h=r<0?360+r:r,a(n)}function T(e){var t=a(e).toHsl();return t.h=(t.h+180)%360,a(t)}function N(e){var t=a(e).toHsl(),n=t.h;return[a(e),a({h:(n+120)%360,s:t.s,l:t.l}),a({h:(n+240)%360,s:t.s,l:t.l})]}function C(e){var t=a(e).toHsl(),n=t.h;return[a(e),a({h:(n+90)%360,s:t.s,l:t.l}),a({h:(n+180)%360,s:t.s,l:t.l}),a({h:(n+270)%360,s:t.s,l:t.l})]}function k(e){var t=a(e).toHsl(),n=t.h;return[a(e),a({h:(n+72)%360,s:t.s,l:t.l}),a({h:(n+216)%360,s:t.s,l:t.l})]}function L(e,t,n){t=t||6,n=n||30;var r=a(e).toHsl(),i=360/n,s=[a(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(a(r));return s}function A(e,t){t=t||6;var n=a(e).toHsv(),r=n.h,i=n.s,s=n.v,o=[],u=1/t;while(t--)o.push(a({h:r,s:i,v:s})),s=(s+u)%1;return o}function _(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function D(e){e=parseFloat(e);if(isNaN(e)||e<0||e>1)e=1;return e}function P(e,t){j(e)&&(e="100%");var n=F(e);return e=s(t,o(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),r.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function H(e){return s(1,o(0,e))}function B(e){return parseInt(e,16)}function j(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function F(e){return typeof e=="string"&&e.indexOf("%")!=-1}function I(e){return e.length==1?"0"+e:""+e}function q(e){return e<=1&&(e=e*100+"%"),e}function R(e){return Math.round(parseFloat(e)*255).toString(16)}function U(e){return B(e)/255}function W(n){n=n.replace(e,"").replace(t,"").toLowerCase();var r=!1;if(O[n])n=O[n],r=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=z.rgb.exec(n))?{r:i[1],g:i[2],b:i[3]}:(i=z.rgba.exec(n))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=z.hsl.exec(n))?{h:i[1],s:i[2],l:i[3]}:(i=z.hsla.exec(n))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=z.hsv.exec(n))?{h:i[1],s:i[2],v:i[3]}:(i=z.hex8.exec(n))?{a:U(i[1]),r:B(i[2]),g:B(i[3]),b:B(i[4]),format:r?"name":"hex8"}:(i=z.hex6.exec(n))?{r:B(i[1]),g:B(i[2]),b:B(i[3]),format:r?"name":"hex"}:(i=z.hex3.exec(n))?{r:B(i[1]+""+i[1]),g:B(i[2]+""+i[2]),b:B(i[3]+""+i[3]),format:r?"name":"hex"}:!1}var e=/^[\s,#]+/,t=/\s+$/,n=0,r=Math,i=r.round,s=r.min,o=r.max,u=r.random,a=function X(e,t){e=e?e:"",t=t||{};if(e instanceof X)return e;if(!(this instanceof X))return new X(e,t);var r=f(e);this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=i(100*this._a)/100,this._format=t.format||r.format,this._gradientType=t.gradientType,this._r<1&&(this._r=i(this._r)),this._g<1&&(this._g=i(this._g)),this._b<1&&(this._b=i(this._b)),this._ok=r.ok,this._tc_id=n++};a.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},setAlpha:function(e){return this._a=D(e),this._roundA=i(100*this._a)/100,this},toHsv:function(){var e=p(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=p(this._r,this._g,this._b),t=i(e.h*360),n=i(e.s*100),r=i(e.v*100);return this._a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=c(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=c(this._r,this._g,this._b),t=i(e.h*360),n=i(e.s*100),r=i(e.l*100);return this._a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return v(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return m(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:i(this._r),g:i(this._g),b:i(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+i(this._r)+", "+i(this._g)+", "+i(this._b)+")":"rgba("+i(this._r)+", "+i(this._g)+", "+i(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:i(P(this._r,255)*100)+"%",g:i(P(this._g,255)*100)+"%",b:i(P(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+i(P(this._r,255)*100)+"%, "+i(P(this._g,255)*100)+"%, "+i(P(this._b,255)*100)+"%)":"rgba("+i(P(this._r,255)*100)+"%, "+i(P(this._g,255)*100)+"%, "+i(P(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:M[v(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+m(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var i=a(e);n=i.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0,i=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="name");if(i)return e==="name"&&this._a===0?this.toName():this.toRgbString();e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString());if(e==="hex"||e==="hex6")n=this.toHexString();return e==="hex3"&&(n=this.toHexString(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),n||this.toHexString()},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(w,arguments)},brighten:function(){return this._applyModification(E,arguments)},darken:function(){return this._applyModification(S,arguments)},desaturate:function(){return this._applyModification(g,arguments)},saturate:function(){return this._applyModification(y,arguments)},greyscale:function(){return this._applyModification(b,arguments)},spin:function(){return this._applyModification(x,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(L,arguments)},complement:function(){return this._applyCombination(T,arguments)},monochromatic:function(){return this._applyCombination(A,arguments)},splitcomplement:function(){return this._applyCombination(k,arguments)},triad:function(){return this._applyCombination(N,arguments)},tetrad:function(){return this._applyCombination(C,arguments)}},a.fromRatio=function(e,t){if(typeof e=="object"){var n={};for(var r in e)e.hasOwnProperty(r)&&(r==="a"?n[r]=e[r]:n[r]=q(e[r]));e=n}return a(e,t)},a.equals=function(e,t){return!e||!t?!1:a(e).toRgbString()==a(t).toRgbString()},a.random=function(){return a.fromRatio({r:u(),g:u(),b:u()})},a.mix=function(e,t,n){n=n===0?0:n||50;var r=a(e).toRgb(),i=a(t).toRgb(),s=n/100,o=s*2-1,u=i.a-r.a,f;o*u==-1?f=o:f=(o+u)/(1+o*u),f=(f+1)/2;var l=1-f,c={r:i.r*f+r.r*l,g:i.g*f+r.g*l,b:i.b*f+r.b*l,a:i.a*s+r.a*(1-s)};return a(c)},a.readability=function(e,t){var n=a(e),r=a(t),i=n.toRgb(),s=r.toRgb(),o=n.getBrightness(),u=r.getBrightness(),f=Math.max(i.r,s.r)-Math.min(i.r,s.r)+Math.max(i.g,s.g)-Math.min(i.g,s.g)+Math.max(i.b,s.b)-Math.min(i.b,s.b);return{brightness:Math.abs(o-u),color:f}},a.isReadable=function(e,t){var n=a.readability(e,t);return n.brightness>125&&n.color>500},a.mostReadable=function(e,t){var n=null,r=0,i=!1;for(var s=0;s<t.length;s++){var o=a.readability(e,t[s]),u=o.brightness>125&&o.color>500,f=3*(o.brightness/125)+o.color/500;if(u&&!i||u&&i&&f>r||!u&&!i&&f>r)i=u,r=f,n=a(t[s])}return n};var O=a.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},M=a.hexNames=_(O),z=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();typeof module!="undefined"&&module.exports?module.exports=a:typeof define=="function"&&define.amd?define("lib/tinycolor",[],function(){return a}):window.tinycolor=a}(),define("utils/Tools",[],function(){"use strict";return{str2ab:function(e){var t,n=new ArrayBuffer(e.length),r=new Uint8Array(n);for(t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return n},a2ab:function(e){return(new Uint8Array(e)).buffer},ab2hexstr:function(e){var t,n="",r=new Uint8Array(e);for(t=0;t<r.length;t++)n+=this.b2hexstr(r[t]);return n},b2hexstr:function(e){return("00"+e.toString(16)).substr(-2)},ab2str:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}),define("views/Slider",["lib/stapes"],function(e){"use strict";function t(e){var t=(e.value-e.min)*100/(e.max-e.min);e.dom.lastElementChild.style.left=t+"%"}function n(e,t){var n,r,i,s,o;e.touches?n=e.touches[0].clientX:n=e.clientX,r=n-t.dom.getBoundingClientRect().left,i=r/t.dom.offsetWidth,s=(t.max-t.min)*i,o=(s-t.min)%t.step,o<=t.step/2?s-=o:s+=t.step-o,s=Math.max(s,t.min),s=Math.min(s,t.max),t.value=s,t.emit("changeValue",s)}return e.subclass({dom:null,min:0,max:100,value:0,step:1,constructor:function(e){this.dom=document.getElementById(e.id),this.setValue(e.value),this.setMin(e.min),this.setMax(e.max),this.setStep(e.step),this.bindEventHandlers()},bindEventHandlers:function(){window.addPointerDownHandler(this.dom,function(e){this.drag=!0,n(e,this),t(this)}.bind(this)),window.addPointerMoveHandler(document,function(e){this.drag&&(n(e,this),t(this))}.bind(this)),window.addPointerUpHandler(this.dom,function(){this.drag=!1,t(this)}.bind(this)),window.addPointerUpHandler(document,function(){this.drag=!1,t(this)}.bind(this),!0)},setValue:function(e){this.value=e||0,t(this)},setMin:function(e){this.min=e||0,t(this)},setMax:function(e){this.max=e||100,t(this)},setStep:function(e){this.step=e||1,t(this)}})}),define("views/MainView",["lib/stapes","lib/tinycolor","utils/Tools","views/Slider"],function(e,t,n,r){"use strict";function s(e,t){var n,r;n=document.querySelector(".work .msg"),n||(n=document.createElement("div"),n.classList.add("msg"),n.classList.add(t),r=document.createElement("div"),r.classList.add("wrapper_msg"),r.classList.add("invisible"),r.appendChild(n),document.querySelector(".work").appendChild(r),setTimeout(function(){r.classList.remove("invisible")},0)),n.classList.contains(t)||(n.className="msg",n.classList.add(t)),n.innerHTML=e,i&&clearTimeout(i),i=setTimeout(function(){var e=document.querySelector(".work .wrapper_msg");e&&e.parentNode.removeChild(e)},1600)}var i;return e.subclass({pointer:null,colorpicker:null,slider:null,sliderinput:null,cpradius:0,cpcenter:0,drag:!1,color:null,brightness:1,inputbox:null,constructor:function(){this.pointer=document.querySelector("#colorpicker #pointer"),this.colorpicker=document.querySelector("#colorpicker #colorwheelbg"),this.slider=new r({id:"brightness",min:0,max:1,step:.02,value:1}),this.inputbox=document.querySelector("#color input.value"),this.cpradius=this.colorpicker.offsetWidth/2,this.cpcenter=this.colorpicker.offsetLeft+this.cpradius,this.bindEventHandlers(),window.dispatchEvent(new Event("resize"))},bindEventHandlers:function(){var e;window.addEventListener("resize",function(){var e,t,n,r=this.colorpicker.parentNode.clientWidth,i=this.colorpicker.parentNode.clientHeight;e=this.colorpicker.getAttribute("width"),t=this.colorpicker.getAttribute("height"),n=e==="auto"?t:e,r>i?t!==n&&(this.colorpicker.setAttribute("height",n),this.colorpicker.setAttribute("width","auto")):e!==n&&(this.colorpicker.setAttribute("height","auto"),this.colorpicker.setAttribute("width",n)),this.cpradius=this.colorpicker.offsetWidth/2,this.cpcenter=this.colorpicker.offsetLeft+this.cpradius,this.color&&this.updatePointer()}.bind(this)),window.addClickHandler(document.querySelector(".footer"),function(e){this.emit("barClick",e.target.parentNode.dataset.area)}.bind(this)),this.slider.on("changeValue",function(e){this.brightness=e,this.updateInput(),this.fireColorEvent()},this),this.inputbox.addEventListener("input",function(e){var n,r=(new t(e.target.value)).toRgb();r.r===0&&r.g===0&&r.b===0?(this.brightness=0,this.color=new t({r:255,g:255,b:255})):(n=Math.max(r.r,r.g,r.b)/256,r.r=Math.round(r.r/n),r.g=Math.round(r.g/n),r.b=Math.round(r.b/n),this.brightness=n,this.color=new t(r)),this.fireColorEvent(),this.updatePointer(),this.updateSlider()}.bind(this),!1),this.inputbox.addEventListener("keydown",function(e){switch(e.keyCode){case 8:case 9:case 16:case 37:case 38:case 39:case 40:case 46:break;default:if(e.target.value.length>=6&&e.target.selectionEnd-e.target.selectionStart===0)e.preventDefault(),e.stopPropagation();else if(e.keyCode<48||e.keyCode>71)e.preventDefault(),e.stopPropagation()}}),e=document.querySelector("#colorpicker .touchrect"),window.addPointerDownHandler(e,function(e){this.leaveInput(),this.drag=!0,this.handleEvent(e)}.bind(this)),window.addPointerMoveHandler(e,function(e){this.drag&&this.handleEvent(e)}.bind(this)),window.addPointerUpHandler(e,function(){this.drag=!1}.bind(this)),window.addClickHandler(document.querySelector("#clear_button"),function(){this.emit("clear")}.bind(this)),window.addClickHandler(document.querySelector("#clearall_button"),function(){this.emit("clearall")}.bind(this))},handleEvent:function(e){var t,n,r;e.touches?(n=e.touches[0].clientX,r=e.touches[0].clientY):(n=e.clientX,r=e.clientY),t=this.getCirclePoint(n,r),this.color=this.getColorFromPoint(t),this.updatePointer(),this.updateSlider(),this.updateInput(),this.fireColorEvent()},getCirclePoint:function(e,t){var n={x:e,y:t},r={x:this.colorpicker.offsetLeft+this.cpradius,y:this.colorpicker.offsetTop+this.cpradius},i;return i=Math.sqrt(Math.pow(e-r.x,2)+Math.pow(t-r.y,2)),i>this.cpradius&&(n.x=r.x+this.cpradius*((e-r.x)/i),n.y=r.y+this.cpradius*((t-r.y)/i)),n},getColorFromPoint:function(e){var n,r,i,s,o;return s=e.x-this.colorpicker.offsetLeft-this.cpradius,o=this.cpradius-e.y+this.colorpicker.offsetTop,r=Math.atan2(o,s),n=(r*(180/Math.PI)+360)%360,i=Math.min(Math.sqrt(s*s+o*o)/this.cpradius,1),new t({h:n,s:i,v:1})},getPointFromColor:function(e){var t,n,r,i={};return t=e.h*(Math.PI/180),r=Math.sin(t)*this.cpradius*e.s,n=Math.cos(t)*this.cpradius*e.s,i.x=Math.round(n+this.colorpicker.offsetLeft+this.cpradius),i.y=Math.round(this.cpradius-r+this.colorpicker.offsetTop),i},fireColorEvent:function(){var e=this.color.toRgb();e.r=Math.round(e.r*this.brightness),e.g=Math.round(e.g*this.brightness),e.b=Math.round(e.b*this.brightness),this.emit("colorChange",e)},setColor:function(e){var n;e.r===0&&e.g===0&&e.b===0?(this.brightness=0,this.color=new t({r:255,g:255,b:255})):(n=Math.max(e.r,e.g,e.b)/256,e.r=Math.round(e.r/n),e.g=Math.round(e.g/n),e.b=Math.round(e.b/n),this.brightness=n,this.color=new t(e)),this.updatePointer(),this.updateSlider(),this.updateInput()},updateSlider:function(){this.slider.setValue(this.brightness),this.slider.dom.style.backgroundImage="-webkit-linear-gradient(left, #000000 0%, "+this.color.toHexString()+" 100%)"},updatePointer:function(){var e=this.getPointFromColor(this.color.toHsv());this.pointer.style.left=e.x-this.pointer.offsetWidth/2+"px",this.pointer.style.top=e.y-this.pointer.offsetHeight/2+"px",this.pointer.style.backgroundColor=this.color.toHexString()},updateInput:function(){var e=this.color.toRgb();e.r=Math.round(e.r*this.brightness),e.g=Math.round(e.g*this.brightness),e.b=Math.round(e.b*this.brightness),this.inputbox.value=n.b2hexstr(e.r)+n.b2hexstr(e.g)+n.b2hexstr(e.b)},scrollToArea:function(e){var t,n;document.querySelector(".footer .selected").classList.remove("selected"),document.querySelector(".footer .button[data-area ="+e+"]").classList.add("selected"),t=document.getElementById(e),n=t.offsetLeft/t.clientWidth,t.parentNode.style.left=-n*100+"%"},showStatus:function(e){s(e,"status")},showError:function(e){s(e,"error")},leaveInput:function(){this.inputbox.blur()}})}),define("api/LocalStorage",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){},get:function(){var e;if(!window.localStorage){this.emit("error","Local Storage not supported");return}localStorage.data&&(e=JSON.parse(localStorage.data),this.emit("got",e))},set:function(e){if(!window.localStorage){this.emit("error","Local Storage not supported");return}localStorage.data=JSON.stringify(e),this.emit("set")}})}),define("models/Settings",["lib/stapes","api/LocalStorage"],function(e,t){"use strict";return e.subclass({storage:null,servers:[],constructor:function(){this.storage=new t,this.storage.on({error:function(e){this.emit("error",e)},got:function(e){e&&(this.servers=e.servers||[]),this.emit("loaded")},set:function(){this.emit("saved")}},this)},save:function(){this.storage.set({servers:this.servers})},load:function(){this.storage.get()},addServer:function(e){this.indexOfServer(e)===-1&&(this.servers.length===0&&(e.selected=!0),this.servers.push(e),this.save(),this.emit("serverAdded",e))},setSelectedServer:function(e){var t;for(t=0;t<this.servers.length;t++)delete this.servers[t].selected;this.servers[e].selected=!0,this.save(),this.emit("serverChanged",this.servers[e])},removeServer:function(e){this.servers.splice(e,1),this.save(),this.emit("serverRemoved")},updateServer:function(e,t){e>=0&&e<this.servers.length&&(this.servers[e]=t,this.save(),this.emit("serverChanged",t))},indexOfServer:function(e){var t,n;for(t=0;t<this.servers.length;t++){n=this.servers[t];if(n.port===e.port&&n.address===e.address)return t}return-1}})}),define("views/ServerList",["lib/stapes"],function(e){"use strict";function t(e){var t,r,i,s,o,u;t=document.createElement("div"),t.classList.add("grouplist"),t.id=e.id,u=document.createElement("div"),u.classList.add("header"),t.appendChild(u),r=document.createElement("div"),r.innerHTML=e.label,r.classList.add("title"),u.appendChild(r),r=document.createElement("div"),r.innerHTML="&#xe804;",r.classList.add("callout"),u.appendChild(r),i=document.createElement("ul"),t.appendChild(i);if(e.list)for(o=0;o<e.list.length;o++)s=n(e.list[o]),i.appendChild(s);return t}function n(e){var t,n,r,i,s;return t=document.createDocumentFragment(),r=document.createElement("div"),r.classList.add("horizontal"),t.appendChild(r),s=document.createElement("div"),s.classList.add("horizontal"),r.appendChild(s),n=document.createElement("div"),n.classList.add("checkbox"),s.appendChild(n),i=document.createElement("div"),i.classList.add("titlebox"),s.appendChild(i),n=document.createElement("label"),n.classList.add("title"),n.innerHTML=e.title||"",i.appendChild(n),n=document.createElement("label"),n.classList.add("subtitle"),n.innerHTML=e.subtitle,i.appendChild(n),n=document.createElement("div"),n.classList.add("touchrect"),s.appendChild(n),n=document.createElement("div"),n.classList.add("edit_icon"),n.innerHTML="&#xe801;",r.appendChild(n),n=document.createElement("div"),n.classList.add("delete_icon"),n.innerHTML="&#xe612;",r.appendChild(n),t}return e.subclass({dom:null,constructor:function(e){this.dom=t(e||{}),this.bindEventHandlers()},bindEventHandlers:function(){window.addClickHandler(this.dom.querySelector(".callout"),function(){this.emit("add")}.bind(this)),window.addClickHandler(this.dom.querySelector("ul"),function(e){e.target.classList.contains("delete_icon")?this.emit("remove",e.target.parentNode.parentNode.id):e.target.classList.contains("edit_icon")?this.emit("edit",e.target.parentNode.parentNode.id):e.target.classList.contains("touchrect")&&this.emit("select",e.target.parentNode.parentNode.parentNode.id)}.bind(this))},getDom:function(){return this.dom},append:function(e,t,n){var r=document.createElement("li");r.id=e,t&&r.classList.add("selected"),r.appendChild(n),this.dom.querySelector("ul").appendChild(r)},replace:function(e,t){var n=this.dom.querySelector("ul li:nth-child("+(e+1)+")"),r;n&&(r=document.createElement("li"),r.appendChild(t),this.dom.querySelector("ul").replaceChild(r,n))},addLine:function(e){var t=n(e);this.append(e.id,e.selected,t)},clear:function(){this.dom.querySelector("ul").innerHTML=""},showAddButton:function(e){e?this.dom.querySelector(".callout").classList.remove("invisible"):this.dom.querySelector(".callout").classList.add("invisible")}})}),define("views/SettingsView",["lib/stapes","views/ServerList"],function(e,t){"use strict";function n(e){var t,n;return t=document.createElement("div"),t.classList.add("inputline"),t.id=e.id,n=document.createElement("label"),n.innerHTML=e.label,t.appendChild(n),n=document.createElement("input"),typeof e.value=="number"&&(n.type="number"),n.value=e.value||"",n.autocomplete="off",n.autocorrect="off",n.autocapitalize="off",t.appendChild(n),t}function r(e){var t,n;return t=document.createElement("div"),t.classList.add("inputline"),n=document.createElement("button"),n.innerHTML=e.label,n.classList.add("OK"),t.appendChild(n),n=document.createElement("button"),n.innerHTML="Cancel",n.classList.add("CANCEL"),t.appendChild(n),t}function i(){var e,t;return e=document.createElement("div"),e.classList.add("line"),t=document.createElement("button"),t.id="detect_button",t.innerHTML="Detect",e.appendChild(t),t=document.createElement("div"),t.classList.add("spinner"),t.classList.add("hidden"),e.appendChild(t),e}return e.subclass({dom:null,serverList:null,constructor:function(){var e=[],s;this.dom=document.querySelector("#settings"),this.serverList=new t({id:"serverList",label:"Server",list:e}),this.serverList.on({add:function(){var e,t;this.enableDetectButton(!1),this.lockList(!0),t=document.createDocumentFragment(),e=n({id:"name",label:"Name:"}),t.appendChild(e),e=n({id:"address",label:"Address:"}),t.appendChild(e),e=n({id:"port",label:"Port:",value:19444}),t.appendChild(e),e=n({id:"priority",label:"Priority:",value:50}),t.appendChild(e),e=n({id:"duration",label:"Duration (sec):",value:0}),t.appendChild(e),e=r({label:"Add"}),window.addClickHandler(e.firstChild,function(e){var t={},n,r=e.target.parentNode.parentNode.querySelectorAll("input");for(n=0;n<r.length;n++)t[r[n].parentNode.id]=r[n].value;t.port=parseInt(t.port),t.priority=parseInt(t.priority),t.duration=parseInt(t.duration),this.emit("serverAdded",t)}.bind(this)),window.addClickHandler(e.lastChild,function(){this.emit("serverAddCanceled")}.bind(this)),t.appendChild(e),this.serverList.append(null,!1,t)},select:function(e){this.dom.classList.contains("locked")||this.emit("serverSelected",parseInt(e.replace("server_","")))},remove:function(e){this.emit("serverRemoved",parseInt(e.replace("server_","")))},edit:function(e){this.emit("editServer",parseInt(e.replace("server_","")))}},this),this.dom.appendChild(this.serverList.getDom()),s=i(),window.addClickHandler(s.querySelector("button"),function(){this.emit("detect")}.bind(this)),this.dom.appendChild(s)},fillServerList:function(e){var t,n,r;this.serverList.clear();for(t=0;t<e.length;t++)n=e[t],r={id:"server_"+t,title:n.name,subtitle:n.address+":"+n.port},n.selected&&(r.selected=!0),this.serverList.addLine(r);this.serverList.showAddButton(!0)},showWaiting:function(e){e?this.dom.querySelector(".spinner").classList.remove("hidden"):this.dom.querySelector(".spinner").classList.add("hidden")},enableDetectButton:function(e){e?this.dom.querySelector("#detect_button").classList.remove("hidden"):this.dom.querySelector("#detect_button").classList.add("hidden")},lockList:function(e){e?(this.dom.classList.add("locked"),this.serverList.showAddButton(!1)):(this.dom.classList.remove("locked"),this.serverList.showAddButton(!0))},editServer:function(e){var t,i;this.lockList(!0),this.enableDetectButton(!1),i=document.createDocumentFragment(),t=n({id:"name",label:"Name:",value:e.server.name}),i.appendChild(t),t=n({id:"address",label:"Address:",value:e.server.address}),i.appendChild(t),t=n({id:"port",label:"Port:",value:e.server.port}),i.appendChild(t),t=n({id:"priority",label:"Priority:",value:e.server.priority}),i.appendChild(t),t=n({id:"duration",label:"Duration (sec):",value:e.server.duration}),i.appendChild(t),t=r({label:"Done"}),window.addClickHandler(t.querySelector("button.OK"),function(t){var n={},r,i=t.target.parentNode.parentNode.querySelectorAll("input");for(r=0;r<i.length;r++)n[i[r].parentNode.id]=i[r].value;n.port=parseInt(n.port),n.priority=parseInt(n.priority),n.duration=parseInt(n.duration),e.server.selected&&(n.selected=!0),this.emit("serverChanged",{index:e.index,server:n})}.bind(this)),window.addClickHandler(t.querySelector("button.CANCEL"),function(){this.emit("serverEditCanceled")}.bind(this)),i.appendChild(t),window.addClickHandler(i.querySelector("input"),function(e){e.stopPropagation()}),this.serverList.replace(e.index,i)}})}),define("views/EffectsView",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){this.bindEventHandlers()},bindEventHandlers:function(){window.addClickHandler(document.querySelector("#effects ul"),function(e){var t=e.target.parentNode.querySelector(".selected");t&&t.classList.remove("selected"),e.target.classList.add("selected"),this.emit("effectSelected",e.target.dataset.id)}.bind(this))},clear:function(){document.querySelector("#effects ul").innerHTML="",document.querySelector("#effects .info").classList.add("hidden")},fillList:function(e){var t,n,r;t=document.createDocumentFragment();for(r=0;r<e.length;r++)n=document.createElement("li"),n.innerHTML=e[r].name,n.dataset.id=e[r].id,t.appendChild(n);document.querySelector("#effects ul").appendChild(t),e.length===0&&document.querySelector("#effects .info").classList.remove("hidden")}})}),define("views/TransformView",["lib/stapes"],function(e){"use strict";function t(e){var t=e.target.parentNode.parentNode.querySelector("ul");t.clientHeight===0?(t.style.maxHeight=t.scrollHeight+"px",e.target.parentNode.parentNode.setAttribute("collapsed","false")):(t.style.maxHeight=0,e.target.parentNode.parentNode.setAttribute("collapsed","true"))}function n(e,t,n,r,i,s,o){var u,a,f,l;return u=document.createElement("li"),u.className=t,f=document.createElement("label"),f.innerHTML=r,u.appendChild(f),l=document.createElement("div"),l.classList.add("wrapper"),l.id=e,a=document.createElement("div"),a.classList.add("icon"),a.innerHTML=n,l.appendChild(a),a=document.createElement("input"),a.type="range",a.min=s,a.max=o,a.step=.01,a.value=i,l.appendChild(a),a=document.createElement("input"),a.classList.add("value"),a.type="number",a.min=s,a.max=o,a.step=.01,a.value=parseFloat(Math.round(i*100)/100).toFixed(2),l.appendChild(a),u.appendChild(l),u}function r(e){var t,r,i,s,o;t=document.createElement("div"),t.classList.add("group"),e.collapsed&&t.setAttribute("collapsed","true"),t.id=e.id,r=document.createElement("div"),r.classList.add("header"),t.appendChild(r),i=document.createElement("label"),i.innerHTML=e.title,r.appendChild(i),i=document.createElement("label"),i.innerHTML=e.subtitle,r.appendChild(i),r=document.createElement("ul"),t.appendChild(r);for(s=0;s<e.members.length;s++)o=e.members[s],i=n(o.id,o.type,o.icon,o.label,o.value,o.min,o.max),r.appendChild(i);return t}return e.subclass({constructor:function(){},clear:function(){document.querySelector("#transform .values").innerHTML=""},onSliderChange:function(e){var t={},n,r;n=e.target.parentNode.id.split("_"),r=parseFloat(Math.round(parseFloat(e.target.value)*100)/100),e.target.type==="range"?e.target.parentNode.querySelector(".value").value=r.toFixed(2):(parseFloat(e.target.value)<parseFloat(e.target.min)?e.target.value=e.target.min:parseFloat(e.target.value)>parseFloat(e.target.max)&&(e.target.value=e.target.max),e.target.parentNode.querySelector("input[type=range]").value=r),t[n[1]]=r,this.emit(n[0],t)},fillList:function(e){var n,i,s,o;if(!e){document.querySelector("#transform .info").classList.remove("hidden");return}n=document.createDocumentFragment(),i=r({collapsed:!0,id:"HSV",title:"HSV",subtitle:"HSV color corrections",members:[{id:"hsv_saturationGain",type:"saturation",icon:"&#xe806;",label:"Saturation gain",value:e.saturationGain,min:0,max:5},{id:"hsv_valueGain",type:"value",icon:"&#xe805;",label:"Value gain",value:e.valueGain,min:0,max:5}]}),n.appendChild(i),i=r({collapsed:!0,id:"Gamma",title:"Gamma",subtitle:"Gamma correction",members:[{id:"gamma_r",type:"red",icon:"&#xe800;",label:"Red",value:e.gamma[0],min:0,max:5},{id:"gamma_g",type:"green",icon:"&#xe800;",label:"Green",value:e.gamma[1],min:0,max:5},{id:"gamma_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.gamma[2],min:0,max:5}]}),n.appendChild(i),i=r({collapsed:!0,id:"Whitelevel",title:"Whitelevel",subtitle:"Value when RGB channel is fully on",members:[{id:"whitelevel_r",type:"red",icon:"&#xe800;",label:"Red",value:e.whitelevel[0],min:0,max:1},{id:"whitelevel_g",type:"green",icon:"&#xe800;",label:"Green",value:e.whitelevel[1],min:0,max:1},{id:"whitelevel_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.whitelevel[2],min:0,max:1}]}),n.appendChild(i),i=r({collapsed:!0,id:"Blacklevel",title:"Blacklevel",subtitle:"Value when RGB channel is fully off",members:[{id:"blacklevel_r",type:"red",icon:"&#xe800;",label:"Red",value:e.blacklevel[0],min:0,max:1},{id:"blacklevel_g",type:"green",icon:"&#xe800;",label:"Green",value:e.blacklevel[1],min:0,max:1},{id:"blacklevel_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.blacklevel[2],min:0,max:1}]}),n.appendChild(i),i=r({collapsed:!0,id:"Threshold",title:"Threshold",subtitle:"Threshold for a channel",members:[{id:"threshold_r",type:"red",icon:"&#xe800;",label:"Red",value:e.threshold[0],min:0,max:1},{id:"threshold_g",type:"green",icon:"&#xe800;",label:"Green",value:e.threshold[1],min:0,max:1},{id:"threshold_b",type:"blue",icon:"&#xe800;",label:"Blue",value:e.threshold[2],min:0,max:1}]}),n.appendChild(i),s=n.querySelectorAll("input");for(o=0;o<s.length;o++)s[o].addEventListener("input",this.onSliderChange.bind(this),!1);s=n.querySelectorAll(".header");for(o=0;o<s.length;o++)window.addClickHandler(s[o],t);document.querySelector("#transform .info").classList.add("hidden"),document.querySelector("#transform .values").appendChild(n)}})}),define("data/ServerControl",["lib/stapes","utils/Tools"],function(e,t){"use strict";return e.subclass({socket:null,server:null,connecting:!1,constructor:function(e,t){this.server=e,this.socket=new t,this.connecting=!1},connect:function(){this.server?(this.connecting=!0,this.socket.create(function(){this.socket.connect(this.server,function(){this.emit("connected"),this.connecting=!1}.bind(this),function(e){this.socket.close(),this.emit("error",e),this.connecting=!1}.bind(this))}.bind(this))):this.emit("error","Missing server info")},disconnect:function(){this.socket.close()},setColor:function(e,t){var n,r;n=[Math.floor(e.r),Math.floor(e.g),Math.floor(e.b)],r={command:"color",color:n,priority:this.server.priority},t&&(r.duration=t*1e3),this.sendCommand(r)},clear:function(){var e={command:"clear",priority:this.server.priority};this.sendCommand(e)},clearall:function(){var e={command:"clearall"};this.sendCommand(e)},runEffect:function(e){var t;if(!e)return;t={command:"effect",effect:{name:e.name,args:e.args},priority:this.server.priority},this.sendCommand(t)},setTransform:function(e){var t;if(!e)return;t={command:"transform",transform:e},this.sendCommand(t)},sendCommand:function(e){var t;if(!e)return;typeof e=="string"?t=e:t=JSON.stringify(e),this.socket.isConnected(function(n){n?this.socket.write(t+"\n",function(){this.emit("cmdSent",e)}.bind(this),function(e){this.emit("error",e)}.bind(this)):this.emit("error","No server connection")}.bind(this))},getServerInfo:function(){var e={command:"serverinfo"};this.socket.isConnected(function(n){n?this.socket.write(JSON.stringify(e)+"\n",function(){this.socket.read(function(e){var n,r=t.ab2str(e);n=JSON.parse(r),this.emit("serverInfo",n.info)}.bind(this),function(e){this.emit("error",e)}.bind(this))}.bind(this),function(e){this.emit("error",e)}.bind(this)):this.emit("error","No server connection")}.bind(this))},isConnecting:function(){return this.connecting}})}),define("api/Socket",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){},create:function(e,t){},isConnected:function(){return!1},connect:function(e,t,n){},close:function(e,t){},read:function(e,t){},write:function(e,t,n){}},!0)}),define("api/WebSocket",["lib/stapes","api/Socket","utils/Tools"],function(e,t,n){"use strict";return t.subclass({DEBUG:!1,handle:null,currentResponseCallback:null,currentErrorCallback:null,inputBuffer:null,inputBufferIndex:0,readBufferTimerId:null,constructor:function(){this.inputBuffer=new Uint8Array(4096),this.inputBufferIndex=0},create:function(e,t){this.DEBUG,e&&e()},isConnected:function(e){this.DEBUG;if(!this.handle){this.DEBUG,e&&e(!1);return}e&&(this.handle.readyState===WebSocket.OPEN?e(!0):e(!1))},connect:function(e,t,n){this.DEBUG,this.currentErrorCallback=n,this.handle=new WebSocket("ws://"+e.address+":"+e.port),this.handle.onmessage=this.onDataReceived.bind(this),this.handle.onclose=function(){this.DEBUG}.bind(this),this.handle.onerror=function(){this.DEBUG,this.currentErrorCallback&&(this.currentErrorCallback("WebSocket error"),this.currentErrorCallback=null)}.bind(this),this.handle.onopen=function(){t&&t()}},close:function(e,t){this.DEBUG,this.handle?(this.handle.close(),e&&e()):(this.DEBUG,t&&t("Socket handle is invalid"))},write:function(e,t,n){var r=null,i=typeof e;this.DEBUG;if(!this.handle){this.DEBUG,n&&n("Socket handle is invalid");return}this.isConnected(function(s){s?(i==="string"?(this.DEBUG,r=e):(this.DEBUG,r=e),this.currentErrorCallback=n,this.handle.send(r),t&&t()):n&&n("No connection to peer")}.bind(this))},read:function(e,t){this.DEBUG;if(!this.handle){this.DEBUG,t&&t("Socket handle is invalid");return}this.isConnected(function(e){e||(this.currentResponseCallback=null,this.currentErrorCallback=null,t&&t("No connection to peer"))}.bind(this)),e&&(this.currentResponseCallback=e),t&&(this.currentErrorCallback=t)},onDataReceived:function(e){this.DEBUG,this.handle&&e.data&&(this.DEBUG,this.currentResponseCallback&&(this.currentResponseCallback(n.str2ab(e.data)),this.currentResponseCallback=null))}},!0)}),define("api/Network",["lib/stapes"],function(e){"use strict";return e.subclass({constructor:function(){}},!0)}),define("controllers/AppController",["lib/stapes","views/MainView","models/Settings","views/SettingsView","views/EffectsView","views/TransformView","data/ServerControl","api/Socket","api/Network"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=new a;return e.subclass({mainView:null,settingsView:null,effectsView:null,transformView:null,settings:null,serverControl:null,color:{r:25,g:25,b:25},effects:[],transform:{},selectedServer:null,isBrowser:!1,constructor:function(){this.mainView=new t,this.settingsView=new r,this.effectsView=new i,this.transformView=new s,this.settings=new n,this.bindEventHandlers(),this.mainView.setColor(this.color),f.getLocalInterfaces||(this.isBrowser=!0,this.settingsView.enableDetectButton(!1))},init:function(){this.settings.load()},bindEventHandlers:function(){this.settings.on({loaded:function(){var e;for(e=0;e<this.settings.servers.length;e++)if(this.settings.servers[e].selected){this.selectedServer=this.settings.servers[e];break}this.settingsView.fillServerList(this.settings.servers),this.selectedServer?this.connectToServer(this.selectedServer):this.gotoArea("settings")},error:function(e){this.showError(e)},serverAdded:function(e){var t;for(t=0;t<this.settings.servers.length;t++)if(this.settings.servers[t].selected){this.selectedServer=this.settings.servers[t],this.connectToServer(e);break}this.settingsView.fillServerList(this.settings.servers)},serverChanged:function(e){var t;for(t=0;t<this.settings.servers.length;t++)if(this.settings.servers[t].selected){this.selectedServer=this.settings.servers[t],this.connectToServer(e);break}this.settingsView.fillServerList(this.settings.servers),this.connectToServer(e)},serverRemoved:function(){var e,t=!0;this.settingsView.fillServerList(this.settings.servers);for(e=0;e<this.settings.servers.length;e++)if(this.settings.servers[e].selected){t=!1;break}t&&(this.selectedServer=null,this.serverControl&&this.serverControl.disconnect(),this.effectsView.clear(),this.transformView.clear())}},this),this.mainView.on({barClick:function(e){e!=="settings"&&(this.selectedServer?this.serverControl||this.connectToServer(this.selectedServer):this.showError("No server selected")),this.gotoArea(e)},colorChange:function(e){this.color=e,this.selectedServer?this.serverControl?this.serverControl.setColor(e,this.selectedServer.duration):this.connectToServer(this.selectedServer,function(){this.serverControl.setColor(e,this.selectedServer.duration)}.bind(this)):this.showError("No server selected")},clear:function(){this.selectedServer?this.serverControl?this.serverControl.clear():this.connectToServer(this.selectedServer,function(){this.serverControl.clear()}.bind(this)):this.showError("No server selected")},clearall:function(){this.selectedServer?this.serverControl?(this.serverControl.clearall(),this.mainView.setColor({r:0,g:0,b:0})):this.connectToServer(this.selectedServer,function(){this.serverControl.clearall(),this.mainView.setColor({r:0,g:0,b:0})}.bind(this)):this.showError("No server selected")}},this),this.settingsView.on({serverAdded:function(e){e.address&&e.port?(e.priority=e.priority||50,this.settings.addServer(e),this.lockSettingsView(!1)):this.showError("Invalid server data")},serverAddCanceled:function(){this.lockSettingsView(!1),this.settingsView.fillServerList(this.settings.servers)},serverEditCanceled:function(){this.lockSettingsView(!1),this.settingsView.fillServerList(this.settings.servers)},serverSelected:function(e){this.lockSettingsView(!1),this.settings.setSelectedServer(e)},serverRemoved:function(e){this.settings.removeServer(e)},serverChanged:function(e){e.server.address&&e.server.port?(e.server.priority=e.server.priority||50,this.settings.updateServer(e.index,e.server),this.lockSettingsView(!1)):this.showError("Invalid server data")},editServer:function(e){var t=this.settings.servers[e];this.settingsView.editServer({index:e,server:t})},durationChanged:function(e){this.settings.duration=e,this.settings.save()},detect:function(){this.lockSettingsView(!0),this.settingsView.showWaiting(!0),this.searchForServer(function(e){this.settings.addServer(e)}.bind(this),function(){this.lockSettingsView(!1),this.settingsView.showWaiting(!1)}.bind(this))}},this),this.effectsView.on({effectSelected:function(e){this.serverControl?this.serverControl.runEffect(this.effects[parseInt(e)]):this.connectToServer(this.selectedServer,function(){this.serverControl.runEffect(this.effects[parseInt(e)])}.bind(this))}},this),this.transformView.on({gamma:function(e){e.r?this.transform.gamma[0]=e.r:e.g?this.transform.gamma[1]=e.g:e.b&&(this.transform.gamma[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},whitelevel:function(e){e.r?this.transform.whitelevel[0]=e.r:e.g?this.transform.whitelevel[1]=e.g:e.b&&(this.transform.whitelevel[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},blacklevel:function(e){e.r?this.transform.blacklevel[0]=e.r:e.g?this.transform.blacklevel[1]=e.g:e.b&&(this.transform.blacklevel[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},threshold:function(e){e.r?this.transform.threshold[0]=e.r:e.g?this.transform.threshold[1]=e.g:e.b&&(this.transform.threshold[2]=e.b),this.serverControl&&this.serverControl.setTransform(this.transform)},hsv:function(e){e.valueGain?this.transform.valueGain=e.valueGain:e.saturationGain&&(this.transform.saturationGain=e.saturationGain),this.serverControl&&this.serverControl.setTransform(this.transform)}},this)},gotoArea:function(e){this.mainView.scrollToArea(e)},connectToServer:function(e,t){if(this.serverControl){if(this.serverControl.isConnecting())return;this.serverControl.off(),this.serverControl.disconnect(),this.transformView.clear(),this.effectsView.clear()}this.serverControl=new o(e,u),this.serverControl.on({connected:function(){this.serverControl.getServerInfo()},serverInfo:function(e){var n;if(!this.selectedServer.name||this.selectedServer.name.length===0)this.selectedServer.name=e.hostname,n=this.settings.indexOfServer(this.selectedServer),this.settings.updateServer(n,this.selectedServer),this.settingsView.fillServerList(this.settings.servers);this.effects=e.effects,this.transform=e.transform[0],this.updateView(),this.showStatus("Connected to "+this.selectedServer.name),t&&t()},error:function(e){this.serverControl=null,this.showError(e)}},this),this.serverControl.connect()},updateView:function(){var e,t=[];if(this.effects)for(e=0;e<this.effects.length;e++)t.push({id:e,name:this.effects[e].name});this.effectsView.clear(),this.effectsView.fillList(t),this.transformView.clear(),this.transformView.fillList(this.transform)},showError:function(e){this.mainView.showError(e)},showStatus:function(e){this.mainView.showStatus(e)},lockSettingsView:function(e){this.isBrowser||this.settingsView.enableDetectButton(!e),this.settingsView.lockList(e)},searchForServer:function(e,t){f.getLocalInterfaces(function(n){function r(t,n){function a(t,n,r){function c(e,t,n){var r=new o({address:e,port:t},u);r.on({error:function(){r.disconnect(),n()},connected:function(){r.getServerInfo()},serverInfo:function(i){var s={address:e,port:t,priority:50};r.disconnect(),i.hostname&&(s.name=i.hostname),n(s)}}),r.connect()}function h(i){var s,o;i&&e&&e(i),f++,f===n&&(s=t.split("."),s[3]=parseInt(s[3])+n,o=s.join("."),r(o))}var i,s,a,f=0,l;i=t.split("."),l=parseInt(i[3]);for(s=0;s<n;s++)i[3]=l+s,a=i.join("."),c(a,19444,h)}function f(e){var t,r=64,i;t=e.split("."),i=parseInt(t[3]);if(i===255){n();return}i+64>254&&(r=255-i),a(e,r,f)}var r,i,s;r=1,i=t.split("."),i[3]=r,s=i.join("."),a(s,64,f)}function i(){n.length===0?t():r(n.pop(),i)}if(n.length===0){t();return}r(n.pop(),i)}.bind(this),function(e){this.showError(e)}.bind(this))}})}),requirejs.config({baseUrl:"js/app",paths:{lib:"../vendor"},map:{"controllers/AppController":{"api/Socket":"api/WebSocket"}}}),window.addPointerDownHandler=function(e,t){"use strict";e.addEventListener("touchstart",function(e){t.apply(this,arguments),e.preventDefault()},!1),e.addEventListener("mousedown",function(){t.apply(this,arguments)},!1)},window.addPointerUpHandler=function(e,t){"use strict";e.addEventListener("touchend",function(e){t.apply(this,arguments),e.preventDefault()},!1),e.addEventListener("mouseup",function(){t.apply(this,arguments)},!1)},window.addPointerMoveHandler=function(e,t){"use strict";e.addEventListener("touchmove",function(e){t.apply(this,arguments),e.preventDefault()},!1),e.addEventListener("mousemove",function(){t.apply(this,arguments)},!1)},window.addClickHandler=function(e,t){"use strict";var n=!1;e.addEventListener("touchstart",function(e){if(e.touches.length>1)return;n=!0},!1),e.addEventListener("touchmove",function(){n=!1},!1),e.addEventListener("touchend",function(e){var r;n&&(t.apply(this,arguments),r=document.querySelector(":focus"),r&&e.target!==r&&r.blur(),e.target.tagName!=="INPUT"&&e.preventDefault())},!1),e.addEventListener("click",function(){t.apply(this,arguments)},!1)},require(["controllers/AppController"],function(e){"use strict";var t=new e;t.init()}),define("main",function(){});